"use strict";(self["webpackChunkportfolio"]=self["webpackChunkportfolio"]||[]).push([[65],{8065:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-row",{attrs:{type:"flex",justify:"space-around"}},[t("el-col",{attrs:{span:6}},[e._v(" 學年期： "),t("el-select",{attrs:{placeholder:e.setting.ymsOption.length>0?"請選擇":"查無學年期，尚未有中央資料庫資料！"},on:{change:e.queryData},model:{value:e.ymsComputed,callback:function(t){e.ymsComputed=t},expression:"ymsComputed"}},e._l(e.setting.ymsOption,(function(s){return t("el-option",{key:s,attrs:{label:e.ymsString(s),value:s}})})),1)],1),t("el-col",{attrs:{span:6}})],1),t("el-divider"),t("el-row",{staticStyle:{"text-align":"right"}},[""!=e.year&&""!=e.sms&&e.setting.openKind.length>0?t("el-button",{attrs:{type:"success"},on:{click:e.tablehandleAdd}},[e._v("新增")]):e._e()],1),""!=e.year&&""!=e.sms?t("el-row",[t("el-col",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"50vh"}},[t("el-table-column",{attrs:{prop:"ser_id",label:"單號",width:"70"}}),t("el-table-column",{attrs:{prop:"kind",label:"項目"}}),t("el-table-column",{attrs:{prop:"cls",label:"類別"}}),t("el-table-column",{attrs:{prop:"name",label:"錯誤別",width:"80"}}),t("el-table-column",{attrs:{prop:"std_feedback",label:"問題"}}),t("el-table-column",{attrs:{prop:"answer",label:"答覆"}}),t("el-table-column",{attrs:{label:"",width:"150"},scopedSlots:e._u([{key:"default",fn:function(s){return e.setting.openKind.indexOf(s.row.kind)>-1?[t("el-button-group",[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.tablehandleEdit(s.row,s.$index)}}},[e._v("編輯")]),t("el-popconfirm",{attrs:{"confirm-button-text":"確定","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"確定刪除？"},on:{confirm:function(t){return e.tablehandleDel(s.row,s.$index)}}},[t("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v("刪除")])],1)],1)]:void 0}}],null,!0)})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.setting.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}}),t("el-dialog",{attrs:{visible:e.setting.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"before-close":e.dialoghandleClose},on:{"update:visible":function(t){return e.$set(e.setting,"dialogVisible",t)}}},[t("el-form",{ref:"myForm",attrs:{model:e.form,rules:e.setting.rules}},[t("el-form-item",{attrs:{label:"項目",prop:"kind"}},[t("el-select",{attrs:{placeholder:"請選擇"},on:{change:function(t){e.form.cls=null}},model:{value:e.form.kind,callback:function(t){e.$set(e.form,"kind",t)},expression:"form.kind"}},e._l(e.kindOption,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"類別",prop:"cls"}},[t("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.cls,callback:function(t){e.$set(e.form,"cls",t)},expression:"form.cls"}},e._l(e.clsOption,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"錯誤別",prop:"error_code"}},[t("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.error_code,callback:function(t){e.$set(e.form,"error_code",t)},expression:"form.error_code"}},e._l(e.setting.errorOption,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"問題回饋",prop:"std_feedback"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.std_feedback,callback:function(t){e.$set(e.form,"std_feedback",t)},expression:"form.std_feedback"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.dialoghandleClose}},[e._v("取 消")]),-1==e.tableDataIndex?t("el-button",{attrs:{type:"primary"},on:{click:e.dialoghandleAdd}},[e._v("新 增")]):t("el-button",{attrs:{type:"primary"},on:{click:e.dialoghandleSave}},[e._v("保 存")])],1)],1)],1)],1):e._e()],1)},o=[],r=(s(7658),{props:{std_urlObject:{type:Object}},data(){return{setting:{ymsOption:[],openKind:[],kindclsOption:[],errorOption:[],dialogVisible:!1,pageSize:10,rules:{kind:[{required:!0,message:"請選擇",trigger:"change"}],cls:[{required:!0,message:"請選擇",trigger:"change"}],error_code:[{type:"number",required:!0,message:"請選擇",trigger:"change"}]}},tableData:[],tableDataIndex:-1,total:0,currentPage:1,sRow:1,eRow:10,form:{year_id:null,sms_id:null,ser_id:0,kind:null,cls:null,token:null,error_code:null,std_feedback:null},year:"",sms:"",std:""}},methods:{ymsString:function(e){let t="",s="";return e.length>3?(t=e.substr(0,3),s=e.substr(3,1)):(t=e.substr(0,2),s=e.substr(2,1)),`${t}學年${s}學期`},getYms(){const e=this,t=`${e.$apiroot}${e.$props.std_urlObject.GetYmsStd}`,s=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.axios.get(t,{params:{arg:e.std},headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status&&(e.setting.ymsOption=t.data.dataset)})).catch((t=>{e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))},GetFeedbackKindCls(){const e=this,t=`${this.$apiroot}${this.$props.std_urlObject.FeedBackKindCls}`,s=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.axios.get(`${t}/${e.year}/${e.sms}`,{headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?e.setting.kindclsOption=t.data.dataset:(e.setting.kindclsOption=[],e.$message.error("查無資料！"))})).catch((t=>{e.setting.kindclsOption=[],e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))},GetFeedbackOpenKind(){const e=this,t=`${this.$apiroot}${this.$props.std_urlObject.FeedBackOpenKind}`,s=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.axios.get(`${t}/${e.year}/${e.sms}`,{headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?e.setting.openKind=t.data.dataset:(e.setting.openKind=[],e.$message.error("查無資料，尚未開放！"))})).catch((t=>{e.setting.openKind=[],e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))},GetFeedBackErrorCode(){const e=this,t=`${this.$apiroot}${this.$props.std_urlObject.FeedBackErrorCode}`,s=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.axios.get(t,{headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?e.setting.errorOption=t.data.dataset:(e.setting.errorOption=[],e.$message.error("查無資料！"))})).catch((t=>{e.setting.errorOption=[],e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))},getFreeback(){const e=this,t=`${this.$apiroot}${this.$props.std_urlObject.StdFeedback}`,s=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.axios.get(t,{params:{year_id:e.year,sms_id:e.sms,sRow:e.sRow,eRow:e.eRow,token:e.$token},headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?(t.data.dataset[0]&&(e.total=t.data.dataset[0].total),e.tableData=t.data.dataset):(e.tableData=[],e.$message.error("查無資料，請先匯入！"))})).catch((t=>{e.tableData=[],e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))},async queryData(){this.GetFeedbackKindCls(),this.GetFeedbackOpenKind(),this.GetFeedBackErrorCode(),await this.getFreeback()},async handleCurrentChange(e){let t=this;t.changePageRange(e),await t.getFreeback(),t.total<10&&init_sRow_eRow()},changePageRange(e){let t=this.setting.pageSize*e;this.sRow=t-this.setting.pageSize+1,this.eRow=t},init_sRow_eRow(){this.sRow=1,this.eRow=10,this.currentPage=1},tablehandleAdd(){let e=this;Object.keys(e.form).forEach((t=>{e.form[t]=null})),this.setting.dialogVisible=!0},tablehandleEdit(e,t){let s=this;Object.keys(s.form).forEach((t=>{s.form[t]=e[t]})),this.tableDataIndex=t,this.setting.dialogVisible=!0},tablehandleDel(e,t){const s=this,a=`${s.$apiroot}${this.$props.std_urlObject.StdFeedback}`,o=s.$loading({lock:!0,text:"設定中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});s.form.year_id=s.year,s.form.sms_id=s.sms,s.form.token=s.std,s.form.ser_id=e.ser_id,s.form.kind=e.kind,s.$http({url:a,method:"delete",data:s.form,headers:{SkyGet:s.$token}}).then((e=>{"Y"==e.data.status?(s.$message.success(e.data.message),s.init_sRow_eRow(),s.getFreeback(),s.dialoghandleClose()):s.$message.error(e.data.message)})).catch((e=>{s.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>o.close()))},dialoghandleClose(){let e=this;Object.keys(e.form).forEach((t=>{e.form[t]=null})),e.form.ser_id=0,e.tableDataIndex=-1,e.setting.dialogVisible=!1},dialoghandleAdd(){const e=this,t=`${this.$apiroot}${this.$props.std_urlObject.StdFeedback}`;e.$refs["myForm"].validate((s=>{if(s){const s=e.$loading({lock:!0,text:"設定中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});e.form.year_id=e.year,e.form.sms_id=e.sms,e.form.token=e.std,e.form.ser_id=0,e.$http({url:t,method:"post",data:e.form,headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?(e.$message.success(t.data.message),e.init_sRow_eRow(),e.getFreeback(),e.dialoghandleClose()):e.$message.error(t.data.message)})).catch((t=>{e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))}}))},dialoghandleSave(){const e=this,t=`${this.$apiroot}${this.$props.std_urlObject.StdFeedback}`;e.$refs["myForm"].validate((s=>{if(s){const s=e.$loading({lock:!0,text:"設定中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});e.form.token=e.$token,e.$http({url:t,method:"put",data:e.form,headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?(e.$message.success(t.data.message),Object.keys(e.form).forEach((t=>{e.tableData[e.tableDataIndex][t]=e.form[t]})),e.dialoghandleClose()):e.$message.error(t.data.message)})).catch((t=>{e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>s.close()))}}))}},components:{},mounted(){},async beforeMount(){this.std=this.$token,await this.getYms()},computed:{ymsComputed:{get(){return this.year+this.sms+""},set(e){e.length>3?(this.year=e.substr(0,3),this.sms=e.substr(3,1)):(this.year=e.substr(0,2),this.sms=e.substr(2,1))}},kindOption(){let e=this;if(e.setting.kindclsOption.length>0){let t=[];return e.setting.kindclsOption.forEach(((s,a,o)=>{-1==t.indexOf(s.kind)&&e.setting.openKind.indexOf(s.kind)>-1&&t.push(s.kind)})),t}return[]},clsOption(){let e=this;if(e.kindOption.length>0){let t=[];return e.setting.kindclsOption.filter((t=>{if(e.form.kind==t.kind)return t})).forEach(((e,s,a)=>{-1==t.indexOf(e.cls)&&t.push(e.cls)})),t}return[]}}}),n=r,l=s(1001),i=(0,l.Z)(n,a,o,!1,null,null,null),d=i.exports}}]);