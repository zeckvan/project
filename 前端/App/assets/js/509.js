"use strict";(self["webpackChunkportfolio"]=self["webpackChunkportfolio"]||[]).push([[509],{509:function(t,e,a){a.r(e),a.d(e,{default:function(){return j}});var s=function(){var t=this,e=t._self._c;return e("div",[e("div",{attrs:{align:"left"}}),e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"學習歷程資料匯出",name:"first"}},[e("StuExport",{attrs:{userStatic:t.userStatic,api_interface:t.api_interface}})],1),e("el-tab-pane",{attrs:{label:"學習歷程資料檔案下載",name:"second"}},[e("StuExportList",{attrs:{userStatic:t.userStatic,api_interface:t.api_interface}})],1),e("el-tab-pane",{attrs:{label:"學習歷程資料匯入",name:"third"}},[e("StuImport",{attrs:{userStatic:t.userStatic,api_interface:t.api_interface}})],1)],1)],1)},r=[],o=function(){var t=this,e=t._self._c;return e("div",[e("div",{attrs:{align:"left"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("新增匯出學生")]),e("el-button",{attrs:{type:"danger"},on:{click:t.del_batch}},[t._v("批次刪除匯出學生")]),e("el-button",{attrs:{type:"warning"},on:{click:t.export_data}},[t._v("資料轉出")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"","row-style":t.rowState,height:"60vh"},on:{"header-click":t.headerclick}},[e("el-table-column",{attrs:{type:"index",width:"50"}}),e("el-table-column",{staticStyle:{cursor:"pointer"},attrs:{prop:"x_status",width:"80","header-align":"center",align:"center",label:"全選"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-checkbox",{model:{value:a.row.x_status,callback:function(e){t.$set(a.row,"x_status",e)},expression:"scope.row.x_status"}})]}}])}),t._l(t.render_header,(function(t){return e("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,width:t.width}})})),e("el-table-column",{attrs:{align:"center",fixed:"right",label:"刪除資料",width:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.del_single(a)}}})]}}])})],2),e("el-pagination",{attrs:{"page-size":t.pageSize,total:t.total,layout:"total,prev, pager, next,sizes"},on:{"current-change":t.current_change,"size-change":t.size_change}}),t.isShow?e("PubStuList",{attrs:{dialog_show:t.dialog_show,userStatic:t.userStatic,api_interface:t.api_interface,data_structure:t.data_structure},on:{"update:dialog_show":function(e){t.dialog_show=e},"get-show":t.getshow,"get-data":t.getstudata}}):t._e()],1)},i=[],l=(a(7658),a(8304)),n=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{title:"學生列表",visible:t.dialogFormVisible,fullscreen:!1,width:"100%","close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e},close:t.close}},[e("el-row",[e("el-col",{attrs:{span:24}},[e("el-form",{attrs:{model:t.form,inline:!0}},[e("el-form-item",{attrs:{label:"班級:",size:"mini"}},[e("el-select",{attrs:{placeholder:"",clearable:!0},model:{value:t.form.cls_id,callback:function(e){t.$set(t.form,"cls_id",e)},expression:"form.cls_id"}},t._l(t.clslist,(function(t){return e("el-option",{key:t.cls_id,attrs:{label:t.cls_abr,value:t.cls_id}})})),1)],1),e("el-form-item",{attrs:{label:"學生學號：",size:"mini"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"輸入學號"},model:{value:t.form.std_no,callback:function(e){t.$set(t.form,"std_no",e)},expression:"form.std_no"}})],1),e("el-form-item",{attrs:{label:"學生姓名：",size:"mini"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"輸入關鍵字篩選"},model:{value:t.form.std_name,callback:function(e){t.$set(t.form,"std_name",e)},expression:"form.std_name"}})],1),e("el-form-item",{attrs:{label:"",size:"mini"}},[e("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.query}},[t._v("查詢")])],1)],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:24}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.stulist,height:"50vh",stripe:"","row-style":t.rowState},on:{"header-click":t.headerclick}},[e("el-table-column",{attrs:{type:"index",width:"50"}}),e("el-table-column",{attrs:{prop:"x_status",width:"80","header-align":"center",align:"center",label:"全選"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-checkbox",{model:{value:a.row.x_status,callback:function(e){t.$set(a.row,"x_status",e)},expression:"scope.row.x_status"}})]}}])}),t._l(t.render_header,(function(t){return e("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,width:t.width}})}))],2),e("el-pagination",{attrs:{"page-size":t.pageSize,total:t.total,layout:"total,prev, pager, next,sizes"},on:{"current-change":t.current_change,"size-change":t.size_change}})],1)],1),e("br"),e("br"),e("div",{attrs:{align:"right"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("新增諮詢學生")]),e("el-button",{attrs:{type:"primary"},on:{click:t.cancel}},[t._v("關閉視窗")])],1)],1)],1)},c=[],u={props:{dialog_show:{type:Boolean},filelist:{type:Array},userStatic:{type:Object},api_interface:{type:Object},data_structure:{type:Object},tea_consult:{type:Object}},data(){return{parameter:{year_id:0,sms_id:0},dialogFormVisible:this.dialog_show,total:0,currentPage:1,pageSize:10,datatemp:[],stulist:[],clslist:[],check_list:[],form:{cls_id:"",std_name:"",year_id:"",sms_id:"",emp_id:"",sch_no:"",sRowNun:1,eRowNun:10,x_status:"",cls_id_q:"",std_name_q:"",std_no_q:"",token:this.$token}}},methods:{rowState(t,e){return{backgroundColor:"#f4f4f5"}},close:function(){this.$emit("get-show",!1)},cancel:function(){this.dialogFormVisible=!1},getshow:function(t){this.isShow=t.show},save:function(){var t=0,e=this;if(e.check_list.length=0,this.stulist.forEach(((a,s)=>{1==a.x_status&&(e.check_list[t++]=a)})),0==e.check_list.length)return e.$message.error("未勾學生，請確認!!"),!1;this.$emit("update:dialog_show",!0),this.dialogFormVisible=!1,this.$emit("get-data",e.check_list)},query:function(){let t=this;const e=t.api_interface.get_studata;""==t.form.std_name?t.form.std_name_q="%":t.form.std_name_q="%"+t.form.std_name+"%",""==t.form.std_no?t.form.std_no_q="%":t.form.std_no_q=t.form.std_no,""==t.form.cls_id?t.form.cls_id_q="%":t.form.cls_id_q=t.form.cls_id;const a=t.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.$http({url:e,method:"get",params:t.form,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?(t.datatemp=e.data.dataset,t.stulist=e.data.dataset,t.stulist=t.stulist.slice(0,10),t.total=e.data.dataset.length):(t.stulist=[],t.$message.error("查無資料!!"))})).catch((e=>{t.stulist=[],t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>{t.form.std_name="",a.close()}))},headerclick(t,e){"全選"==t.label?(t.label="全不選",this.stulist.forEach(((t,e)=>{0!=t.x_status&&""!=t.x_status||(t.x_status=!0)}))):(t.label="全選",this.stulist.forEach(((t,e)=>{1!=t.x_status&&""!=t.x_status||(t.x_status=!1)})))},current_change(t){var e=this,a="",s="";a=(t-1)*e.pageSize+1,s=t*e.pageSize,e.currentPage=t,e.form.sRowNun=a,e.form.eRowNun=s,e.stulist=e.datatemp,e.stulist=e.stulist.slice(e.form.sRowNun,e.form.eRowNun+1)},size_change(t){var e=this,a="",s="";a=(e.currentPage-1)*t+1,s=e.currentPage*t,e.pageSize=t,e.form.sRowNun=a,e.form.eRowNun=s,e.stulist=e.datatemp,e.stulist=e.stulist.slice(e.form.sRowNun,e.form.eRowNun+1)}},mounted(){let t=this;const e=`${t.$apiroot}/S04_stucls`;t.$http({url:e,method:"get",params:t.parameter,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?t.clslist=e.data.dataset:t.clslist=[]})).catch((e=>{t.clslist=[],t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally()},computed:{render_header(){let t=this.data_structure.sub_header.filter((t=>"N"===t.hidden)).sort((function(t,e){return t.sort>e.sort?1:-1}));return t}}},d=u,h=a(1001),p=(0,h.Z)(d,n,c,!1,null,"3d49c1f4",null),f=p.exports,m={props:{userStatic:{type:Object},api_interface:{type:Object},total:{type:Number}},data(){return{currentPage:1,pageSize:10,data_structure:{},dialog_show:!0,isShow:!1,tableData:[],check_list:[],sch_no:"",filename:""}},methods:{export_data:function(){let t=new Date;var e=t.getFullYear().toString(),a=t.getMonth().toString()>=10?t.getMonth().toString():"0"+t.getMonth().toString(),s=t.getDate().toString()>=10?t.getDate().toString():"0"+t.getDate().toString(),r=t.getHours().toString()>=10?t.getHours().toString():"0"+t.getHours().toString(),o=t.getMinutes().toString()>=10?t.getMinutes().toString():"0"+t.getMinutes().toString(),i=t.getSeconds().toString()>=10?t.getSeconds().toString():"0"+t.getSeconds().toString();this.filename=this.sch_no+"_"+e+"_"+a+"_"+s+"_"+r+"_"+o+"_"+i+".zip";var l=0,n=this;let c=new FormData;n.check_list.length=0;const u=n.api_interface.export_data;if(this.tableData.forEach(((t,e)=>{1==t.x_status&&(t.row=e,n.check_list[l++]=t,c.append("std_no[]",t.std_no))})),c.append("getDate",this.filename),0==n.check_list.length)return n.$message.error("未勾選學生，請確認!!"),!1;n.$confirm("確認轉出學生資料?","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=n.$loading({lock:!0,text:"資料轉出中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});n.$http({headers:{SkyGet:n.$token},url:u,method:"post",data:c}).then((t=>{"Y"==t.data.status?n.$message.success("匯出成功!!"):n.$message.error("匯出失敗!!")})).catch((t=>{n.$message.error("匯出發生錯誤:"+t)})).finally((()=>t.close()))})).catch((()=>{}))},del_single:function(t){0==t.$index?this.tableData.splice(0,1):this.tableData.splice(t.$index,1)},rowState(t,e){return{backgroundColor:"#f4f4f5"}},headerclick(t,e){"全選"!=t.label&&"全不選"!=t.label||("全選"==t.label?(t.label="全不選",this.tableData.forEach(((t,e)=>{0!=t.x_status&&""!=t.x_status||(t.x_status=!0)}))):(t.label="全選",this.tableData.forEach(((t,e)=>{1!=t.x_status&&""!=t.x_status||(t.x_status=!1)}))))},add:function(){this.isShow=!0},del_batch:function(){var t=0,e=this;if(e.check_list.length=0,this.tableData.forEach(((a,s)=>{1==a.x_status&&(a.row=s,e.check_list[t++]=a)})),0==e.check_list.length)return e.$message.error("未勾選學生，請確認!!"),!1;for(t=0;t<e.check_list.length;t++)e.tableData.forEach((function(a,s,r){e.check_list[t].std_no==a.std_no&&e.tableData.splice(s,1)}))},current_change(t){var e=this;e.pageSize,e.pageSize,e.currentPage=t},size_change(t){var e=this;e.currentPage,e.currentPage,e.pageSize=t},getshow:function(t){this.isShow=t.show},getstudata:function(t){this.tableData=this.tableData.concat(t);const e=[],a=new Map;for(const s of this.tableData)a.has(s.std_no)||(a.set(s.std_no,!0),e.push(s));this.tableData=e.sort((function(t,e){return t.std_no>e.std_no?1:-1})),this.tableData.forEach((function(t,e,a){t.x_status=!1})),this.tableData.length>0&&(this.sch_no=this.tableData[0].sch_no)},cellmouseenter(t,e,a,s){},download:function(t){let e=this,a=t.data,s=new Blob([a]);if("download"in document.createElement("a"))if("OK"==t.statusText||"200"==t.status){let t=document.createElement("a");t.download=e.filename,t.style.displya="none",t.href=URL.createObjectURL(s),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}else e.$message.error("檔案下載發生錯誤!!");else navigator.msSaveBold(s,filename)}},components:{PubStuList:f},beforeDestroy(){},mounted(){},beforeMount(){switch(this.userStatic.data_structure){case"StuTurnExport":this.data_structure=l.F6;break;default:}},computed:{render_header(){console.log(this.data_structure);let t=this.data_structure.header.filter((t=>"N"===t.hidden)).sort((function(t,e){return t.sort>e.sort?1:-1}));return t}}},_=m,g=(0,h.Z)(_,o,i,!1,null,null,null),b=g.exports,w=function(){var t=this,e=t._self._c;return e("div",[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"","row-style":t.rowState,height:"60vh"},on:{"header-click":t.headerclick}},[e("el-table-column",{attrs:{type:"index",width:"50"}}),t._l(t.render_header,(function(t){return e("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,width:t.width}})})),e("el-table-column",{attrs:{label:"下載檔案",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-picture",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.file_download(a)}}})]}}])})],2),e("el-pagination",{attrs:{"page-size":t.pageSize,total:t.total,layout:"total,prev, pager, next,sizes"},on:{"current-change":t.current_change,"size-change":t.size_change}})],1)},y=[],S="",k={props:{userStatic:{type:Object},api_interface:{type:Object},total:{type:Number}},data(){return{currentPage:1,pageSize:10,data_structure:{},dialog_show:!0,isShow:!1,tableData:[],check_list:[],sch_no:"",filename:""}},methods:{file_download:function(t){var e=this;const a=e.$loading({lock:!0,text:"資料轉出中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});S=e.api_interface.export_file,e.$http({headers:{SkyGet:e.$token},url:S,method:"get",params:{id:t.row.id},responseType:"blob"}).then((a=>{e.download(a,t)})).catch((t=>{e.$message.error("檔案下載發生錯誤:"+t)})).finally((()=>a.close()))},del_single:function(t){0==t.$index?this.tableData.splice(0,1):this.tableData.splice(t.$index,1)},rowState(t,e){return{backgroundColor:"#f4f4f5"}},headerclick(t,e){"全選"!=t.label&&"全不選"!=t.label||("全選"==t.label?(t.label="全不選",this.tableData.forEach(((t,e)=>{0!=t.x_status&&""!=t.x_status||(t.x_status=!0)}))):(t.label="全選",this.tableData.forEach(((t,e)=>{1!=t.x_status&&""!=t.x_status||(t.x_status=!1)}))))},add:function(){this.isShow=!0},del_batch:function(){var t=0,e=this;if(e.check_list.length=0,this.tableData.forEach(((a,s)=>{1==a.x_status&&(a.row=s,e.check_list[t++]=a)})),0==e.check_list.length)return e.$message.error("未勾選學生，請確認!!"),!1;for(t=0;t<e.check_list.length;t++)e.tableData.forEach((function(a,s,r){e.check_list[t].std_no==a.std_no&&e.tableData.splice(s,1)}))},current_change(t){var e=this;e.pageSize,e.pageSize,e.currentPage=t},size_change(t){var e=this;e.currentPage,e.currentPage,e.pageSize=t},getshow:function(t){this.isShow=t.show},getstudata:function(t){this.tableData=this.tableData.concat(t);const e=[],a=new Map;for(const s of this.tableData)a.has(s.std_no)||(a.set(s.std_no,!0),e.push(s));this.tableData=e.sort((function(t,e){return t.std_no>e.std_no?1:-1})),this.tableData.forEach((function(t,e,a){t.x_status=!1})),this.tableData.length>0&&(this.sch_no=this.tableData[0].sch_no)},cellmouseenter(t,e,a,s){},download:function(t,e){let a=this,s=t.data,r=new Blob([s]);if("download"in document.createElement("a"))if("OK"==t.statusText||"200"==t.status){let t=document.createElement("a");t.download=e.row.file_name+"."+e.row.file_extension,t.style.displya="none",t.href=URL.createObjectURL(r),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}else a.$message.error("檔案下載發生錯誤!!");else navigator.msSaveBold(r,filename)}},components:{PubStuList:f},beforeDestroy(){},mounted(){let t=this;S=t.api_interface.list_file,t.$http({url:S,method:"get",headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?t.tableData=e.data.dataset:t.tableData=[]})).catch((e=>{t.tableData=[],t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally()},beforeMount(){switch(this.userStatic.data_structure){case"StuTurnExport":console.log(l.F6),this.data_structure=l.F6;break;default:}},computed:{render_header(){console.log(this.data_structure);let t=this.data_structure.file_header.filter((t=>"N"===t.hidden)).sort((function(t,e){return t.sort>e.sort?1:-1}));return t}}},x=k,v=(0,h.Z)(x,w,y,!1,null,null,null),$=v.exports,D=function(){var t=this,e=t._self._c;return e("div",[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"解壓縮密碼",prop:"password"}},[e("el-input",{model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("el-form-item",{attrs:{label:"MD5",prop:"md5"}},[e("el-input",{model:{value:t.form.md5,callback:function(e){t.$set(t.form,"md5",e)},expression:"form.md5"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"壓縮檔",prop:"file"}},[e("input",{ref:"file",staticClass:"el-input",attrs:{type:"file"},on:{change:t.onFileChange}})])],1)],1),e("el-row",[e("el-col",[e("el-form-item",[e("el-button",{attrs:{type:"primary","native-type":"button"},on:{click:function(e){return t.submitForm("form")}}},[t._v("上傳")]),e("el-button",{on:{click:function(e){return t.resetForm("form")}}},[t._v("重置")])],1)],1)],1)],1),"Y"==t.is_success?e("el-alert",{attrs:{title:"匯入成功!!",type:"success",description:"","show-icon":""}}):"N"==t.is_success?e("el-alert",{attrs:{title:"匯入失敗",type:"error",description:t.error,"show-icon":""}}):t._e()],1)},z=[],E=(a(1120),{props:{userStatic:{type:Object},api_interface:{type:Object},total:{type:Number}},data(){return{year_option:[],sms_option:[],form:{year:"",sms:"",password:"",md5:"",file:null},error:"",is_success:"",rules:{year:[{required:!0,message:"請選擇學年",trigger:"change"}],sms:[{required:!0,message:"請選擇學期",trigger:"change"}],password:[{required:!0,message:"請輸入密碼",trigger:"change"}],file:[{required:!0,message:"請選擇",trigger:"change"}]}}},computed:{selectYear(){let t=(new Date).getFullYear()-1911;t+=1;let e=[t];for(let a=0;a<6;a++)e.push(--t);return e}},methods:{submitForm(t){let e=this;this.$refs[t].validate((t=>{if(t){const t=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),a=e.api_interface.import_file;let s=new FormData;s.append("Password",e.form.password),s.append("files",e.form.file[0]),e.$http({url:a,method:"post",data:s,headers:{"Content-Type":"multipart/form-data",SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?e.is_success="Y":e.$message.error(t.data.error_msg)})).catch((t=>{e.error=t,e.is_success="N"})).finally((()=>{e.resetForm("form"),t.close()}))}}))},resetForm(t){this.$refs["file"].value="",this.$refs[t].resetFields()},onFileChange(t){let e=t.target.files||t.dataTransfer.files;e.length&&(this.form.file=e)},getsmsOption(){let t=this;const e=`${t.$apiroot}/s90smsinfo`;t.$http({url:e,method:"get",headers:{SkyGet:t.$token}}).then((e=>{t.sms_option=e.data.dataset.filter((function(t){return 1==t.sms_id||2==t.sms_id}))})).catch((e=>{t.$message.error("呼叫後端【s90smsinfo】發生錯誤,"+e)})).finally()},getyearOption(){let t=this;const e=`${t.$apiroot}/s90yearinfo`;t.$http({url:e,method:"get",headers:{SkyGet:t.$token}}).then((e=>{t.year_option=e.data.dataset})).catch((e=>{t.$message.error("呼叫後端【s90yearinfo】發生錯誤,"+e)})).finally()}},mounted:function(){this.getyearOption(),this.getsmsOption()}}),N=E,O=(0,h.Z)(N,D,z,!1,null,null,null),F=O.exports,C={name:"StuTurnView",props:{userStatic:{type:Object},api_interface:{type:Object}},data:function(){return{activeName:"first",activePage:"0"}},components:{StuExport:b,StuExportList:$,StuImport:F},methods:{},mounted:function(){},beforeDestroy(){},mounted(){}},R=C,P=(0,h.Z)(R,s,r,!1,null,null,null),j=P.exports}}]);