"use strict";(self["webpackChunkportfolio"]=self["webpackChunkportfolio"]||[]).push([[108],{4579:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var r=function(){var e=this,t=e._self._c;return t("div",[t("PubQuery",{on:{"get-condition":e.getcondition}}),t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"審查課程學習成果通過/不通過",name:"first"}},[t("TeaAttestationGrid",{attrs:{userStatic:e.userStatic,api_interface:e.api_interface,tableData:e.tableVerify,total:e.pagetotal1,activePage:e.activePage,parameter:e.parameter}})],1),t("el-tab-pane",{attrs:{label:"發佈課程學習成果",name:"second"}},[t("TeaAttestationGrid",{attrs:{userStatic:e.userStatic,api_interface:e.api_interface,tableData:e.tableRelease,total:e.pagetotal1,activePage:e.activePage,parameter:e.parameter}})],1)],1)],1)},s=[],o=a(5705),n=function(){var e=this,t=e._self._c;return t("div",["Y"==e.operate_state.open_yn?t("div"):t("div",[t("el-alert",{attrs:{closable:!1,title:"系統開放認證時間："+e.operate_state.startdate+"~"+e.operate_state.enddate,type:"error"}})],1),t("div",{attrs:{align:"left"}},["0"==e.activePage?t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.batchVerify}},[e._v("批次審核")]),e._v(" 審核狀態： "),t("el-select",{attrs:{placeholder:""},model:{value:e.passStatus,callback:function(t){e.passStatus=t},expression:"passStatus"}},e._l(e.passStatusList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"1"==e.activePage?t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.batchRelease}},[e._v("批次發佈")])],1):e._e()]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"67vh",stripe:"","row-style":e.rowState},on:{"row-click":e.rowClick,"header-click":e.headerclick}},[t("el-table-column",{attrs:{type:"index",width:"50"}}),e.data_structure.checkbox?t("el-table-column",{staticStyle:{cursor:"pointer"},attrs:{prop:"x_status",width:"80","header-align":"center",align:"center",label:"全選"},scopedSlots:e._u([{key:"default",fn:function(a){return[""==a.row.x_status||1==a.row.x_status||0==a.row.x_status?t("div",[t("el-checkbox",{model:{value:a.row.x_status,callback:function(t){e.$set(a.row,"x_status",t)},expression:"scope.row.x_status"}})],1):t("div")]}}],null,!1,1702804916)}):e._e(),e._l(e.render_header,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,width:a.width,align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[a.slot?t("div",["0"==e.activePage?t("div",["attestation_status"==a.col?t("div",[t("el-dropdown",{attrs:{"split-button":"",type:"primary",size:"small",disabled:"Y"==r.row.v},on:{command:e.handleCommand}},[e._v(" "+e._s("Y"==r.row.n?"通過":"F"==r.row.n?"未通過":"認證中")+" "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"Y"},nativeOn:{click:function(t){return e.verify(r.row)}}},[e._v("通過")]),t("el-dropdown-item",{attrs:{command:"F"},nativeOn:{click:function(t){return e.verify(r.row)}}},[e._v("未通過")])],1)],1)],1):"attestation_release"==a.col?t("div",["N"==r.row.v||""==r.row.v||null==r.row.v?t("div",[t("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v("未發佈")])],1):"Y"==r.row.v?t("div",[t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("已發佈")])],1):e._e()]):"attestation_reason"==a.col?t("div",["F"==r.row.n?t("div",[t("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[t("el-select",{attrs:{placeholder:"輸入不通過原因"},model:{value:r.row.w,callback:function(t){e.$set(r.row,"w",t)},expression:"scope.row.w"}},e._l(e.attestation_reasonList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("br"),t("br"),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.attestation_reason_save(r.row)}}},[e._v("存檔")]),t("i",{class:""==r.row.w||null==r.row.w?"el-icon-edit":"el-icon-document",staticStyle:{cursor:"pointer"},attrs:{slot:"reference"},on:{click:function(t){return e.reason_edit(r)}},slot:"reference"})],1)],1):e._e()]):e._e()]):e._e(),"1"==e.activePage?t("div",["attestation_status"==a.col?t("div",["Y"==r.row.n?t("div",[t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("通過")])],1):t("div",[t("el-tag",{attrs:{type:"danger",effect:"dark"}},[e._v("未通過")])],1)]):"attestation_release"==a.col?t("div",["N"==r.row.v||""==r.row.v||null==r.row.v?t("div",[t("el-tag",{staticStyle:{cursor:"pointer"},attrs:{type:"success",effect:"dark"},nativeOn:{click:function(t){return e.Release(r.row)}}},[e._v("未發佈")])],1):"Y"==r.row.v?t("div",[t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("已發佈")])],1):e._e()]):e._e()]):e._e()]):t("div",[e._v(" "+e._s(r.row[a.prop])+" ")])]}}],null,!0)})})),t("el-table-column",{attrs:{align:"center",fixed:"right",label:"查看檔案",width:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-badge",{staticClass:"item",staticStyle:{cursor:"pointer"},attrs:{value:a.row.x_cnt,type:"info"},nativeOn:{click:function(t){return e.file_data(a)}}})]}}])})],2),e.isShow?t(e.content,{tag:"component",attrs:{dialog_show:e.dialog_show,edit_model:e.edit_model,parameter:e.parameter,data_structure:e.data_structure,userStatic:e.userStatic,api_interface:e.api_interface},on:{"update:dialog_show":function(t){e.dialog_show=t},"get-show":e.getshow}}):e._e(),e.isShow2?t("v-stufilelist",{attrs:{dialog_show:e.dialog_show2,filelist:e.filelist,userStatic:e.userStatic,parameter:e.parameter,api_interface:e.api_interface},on:{"update:dialog_show":function(t){e.dialog_show2=t},"get-show":e.getshow2}}):e._e(),e.isShow3?t("v-fileupload",{attrs:{dialog_show:e.dialog_show3,filelist:e.filelist,userStatic:e.userStatic,api_interface:e.api_interface,parameter:e.parameter,data_structure:e.data_structure,rowdata:e.rowdata},on:{"update:dialog_show":function(t){e.dialog_show3=t},"get-show":e.getshow3}}):e._e()],1)},i=[],l=a(2081),c=a(2301),d=a(9005),u=a(4876),p=a(8304),_="",h={props:{userStatic:{type:Object},api_interface:{type:Object},tableData:{type:Array},total:{type:Number},activePage:{type:String},parameter:{type:Object}},data(){return{content:this.userStatic.form_component,data_structure:{},isShow:!1,isShow2:!1,isShow3:!1,dialog_show:!0,dialog_show2:!0,dialog_show3:!0,currentPage:1,pageSize:10,year:"",sms:"",edit_model:"",filelist:[],rowdata:{},passStatus:"Y",passStatusList:[{value:"Y",label:"通過"},{value:"F",label:"未通過"}],passStatusDropDown:"認證中",check_list:[],attestation_reason:"",attestation_reason_show:!0,attestation_reasonList:[{value:"01",label:"非本課程相關主題成果，無法認證"},{value:"02",label:"無法查證成果可信度"},{value:"03",label:"請加強成果內容正確性"},{value:"04",label:"請增加成果內容豐富度"}],operate_state:{open_yn:"",startdate:"",enddate:""}}},methods:{attestation_reason_save:function(e){let t=this,a=new FormData;e.n;a.append("complex_key[]",e.a+"_"+e.b+"_"+e.c+"_"+e.d+"_"+e.e+"_"+e.f+"_"+e.g+"_"+e.h+"@"+e.w),a.append("token",t.$token);const r=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=t.api_interface.save_Reason;t.$http({url:s,method:"put",data:a,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?t.$message.success("存檔成功!!"):t.$message.error(e.data.message)})).catch((e=>{t.$message({message:"存檔失敗:"+e,type:"error",duration:0,showClose:!0})})).finally((()=>r.close()))},attestation_reason_cancel:function(){},reason_edit:function(){},headerclick(e,t){"全選"!=e.label&&"全不選"!=e.label||("全選"==e.label?(e.label="全不選",this.tableData.forEach(((e,t)=>{0!=e.x_status&&""!=e.x_status||(e.x_status=!0)}))):(e.label="全選",this.tableData.forEach(((e,t)=>{1!=e.x_status&&""!=e.x_status||(e.x_status=!1)}))))},batchVerify:function(){var e=0;let t=this,a=new FormData,r="";return!!t.check_operate()&&(t.check_list.length=0,this.tableData.forEach(((a,r)=>{1==a.x_status&&(t.check_list[e++]=a)})),0==t.check_list.length?(t.$message.error("未勾選認證學生，請確認!!"),!1):(r="Y"==this.passStatus?"確定將認證狀態改為通過?":"確定將認證狀態改為未通過?",t.check_list.forEach((function(e,r,s){a.append("complex_key[]",e.a+"_"+e.b+"_"+e.c+"_"+e.d+"_"+e.e+"_"+e.f+"_"+e.g+"_"+e.h+"@"+t.passStatus)})),a.append("token",t.$token),void t.$confirm(`${r}`,"Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=t.api_interface.save_Verify;t.$http({url:r,method:"put",data:a,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?(t.$message.success("變更成功!!"),t.check_list.forEach((function(e,a,r){e.n=t.passStatus}))):t.$message.error(e.data.message)})).catch((e=>{t.$message({message:"變更失敗:"+e,type:"error",duration:0,showClose:!0})})).finally((()=>e.close()))})).catch((()=>{}))))},batchRelease:function(){var e=0;let t=this,a=new FormData;return!!t.check_operate()&&(t.check_list.length=0,this.tableData.forEach(((a,r)=>{1==a.x_status&&(t.check_list[e++]=a)})),0==t.check_list.length?(t.$message.error("未勾選發佈學生，請確認!!"),!1):(t.check_list.forEach((function(e,t,r){a.append("complex_key[]",e.a+"_"+e.b+"_"+e.c+"_"+e.d+"_"+e.e+"_"+e.f+"_"+e.g+"_"+e.h)})),a.append("token",t.$token),void t.$confirm("確認將已勾選的學生認証發佈","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=t.api_interface.save_Release;t.$http({url:r,method:"put",data:a,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?t.$message.success("發佈成功!!"):t.$message.error(e.data.message)})).catch((e=>{t.$message({message:"發佈失敗:"+e,type:"error",duration:0,showClose:!0})})).finally((()=>e.close()))})).catch((()=>{}))))},Release:function(e){let t=this,a=new FormData;e.n;if(!t.check_operate())return!1;a.append("complex_key[]",e.a+"_"+e.b+"_"+e.c+"_"+e.d+"_"+e.e+"_"+e.f+"_"+e.g+"_"+e.h),a.append("token",t.$token),this.$confirm("確認將此學生認証發佈??","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=t.api_interface.save_Release;t.$http({url:r,method:"put",data:a,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?t.$message.success("發佈成功!!"):t.$message.error(e.data.message)})).catch((e=>{t.$message({message:"發佈失敗:"+e,type:"error",duration:0,showClose:!0})})).finally((()=>e.close()))})).catch((()=>{}))},verify:function(e){let t=this,a="",r=new FormData,s=e.n;if(!t.check_operate())return!1;r.append("complex_key[]",e.a+"_"+e.b+"_"+e.c+"_"+e.d+"_"+e.e+"_"+e.f+"_"+e.g+"_"+e.h+"@"+t.passStatusDropDown),r.append("token",t.$token),a="Y"==this.passStatusDropDown?"確定將認證狀態改為通過?":"確定將認證狀態改為未通過?",this.$confirm(`${a}`,"Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=t.api_interface.save_Verify;t.$http({url:s,method:"put",data:r,headers:{SkyGet:t.$token}}).then((a=>{"Y"==a.data.status?(t.$message.success("變更成功!!"),e.n=t.passStatusDropDown):t.$message.error(a.data.message)})).catch((e=>{t.$message({message:"變更失敗:"+e,type:"error",duration:0,showClose:!0})})).finally((()=>a.close()))})).catch((()=>{""==s&&(e.n="")}))},handleCommand(e){this.passStatusDropDown=e},rowClick(e,t,a){this.$emit("get-studata",e)},rowState(e,t){return{backgroundColor:"#f4f4f5"}},add:function(){this.edit_model="add",this.isShow=!0},edit_data:function(e){let t=this;this.data_structure.header.forEach((function(a,r,s){"Y"==a.parameter&&(t.parameter[a.col]=e.row[a.prop])})),this.edit_model="edit",this.isShow=!0},file_data:function(e){let t=this,a="";_=t.api_interface.file_data;const r=t.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.data_structure.header.forEach((function(a,r,s){"Y"==a.parameter&&(t.parameter[a.col]=e.row[a.prop])})),t.parameter["class_name"]=t.userStatic.interface,t.parameter.sRowNun=1,t.parameter.eRowNun=999,a=`${e.row.a}_${e.row.b}_${e.row.c}_${e.row.d}_${e.row.e}_${e.row.f}_${e.row.g}_${e.row.h}_0`,t.parameter["complex_key"]=a,t.parameter["token"]=t.$token,t.$http({url:_,method:"get",params:t.parameter,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?t.filelist=e.data.dataset:(t.filelist=[],t.$message.error("查無資料，請確認"))})).catch((e=>{t.tableData=[],t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>r.close())),this.isShow2=!0},file_upload:function(e){let t=this;_=t.api_interface.file_upload,t.rowdata=e,t.data_structure.header.forEach((function(a,r,s){"Y"==a.parameter&&(t.parameter[a.col]=e.row[a.prop])})),this.isShow3=!0},del_data:function(e){let t=this;if("Y"===this.data_structure.delete_rule.rule_flag&&!this.data_structure.delete_rule.rule_check(e,t))return!1;t.$confirm("確定刪除?","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a=t.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let r=new FormData;t.data_structure.header.forEach((function(a,s,o){"Y"==a.parameter&&(t.parameter[a.col]=e.row[a.prop],r.append(a.col,e.row[a.prop]))})),r.append("class_name",t.userStatic.interface),r.append("token",t.$token),_=t.api_interface.del_data,t.$http({headers:{"Content-Type":"application/json;charset=utf-8",SkyGet:t.$token},url:_,method:"delete",data:r}).then((a=>{"Y"==a.data.status?(t.$message.success("刪除成功!!"),t.tableData.splice(e.$index,1)):t.$message.error("刪除失敗!!")})).catch((e=>{t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>a.close()))})).catch((()=>{}))},getshow:function(e){this.isShow=e.show},getshow2:function(e){this.isShow2=e.show},getshow3:function(e){this.isShow3=e.show},getcondition:function(e){var t=this;t.year=e.year,t.sms=e.sms,_=t.api_interface.get_data,this.get_data(_,e.year,e.sms,t.currentPage,t.pageSize)},current_change(e){var t=this,a="",r="";a=(e-1)*t.pageSize+1,r=e*t.pageSize,t.currentPage=e,_=t.api_interface.get_data,this.get_data(_,t.year,t.sms,a,r)},size_change(e){var t=this,a="",r="";a=(t.currentPage-1)*e+1,r=t.currentPage*e,t.pageSize=e,_=t.api_interface.get_data,this.get_data(_,t.year,t.sms,a,r)},get_data:function(e,t,a,r,s){let o=this;const n=o.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});o.parameter.emp_id="",o.parameter.year_id=t,o.parameter.sms_id=a,o.parameter.sRowNun=r,o.parameter.eRowNun=s,o.parameter.sch_no="",o.parameter.token=o.$token,o.$http({url:e,method:"get",params:o.parameter,headers:{SkyGet:o.$token}}).then((e=>{"Y"==e.data.status?(o.tableData=e.data.dataset,o.total=e.data.dataset[0].x_cnt):(o.tableData=[],o.$message.error("查無資料，請確認"))})).catch((e=>{console.log(e),o.tableData=[],o.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>n.close()))},check_operate:function(){return"N"!=this.operate_state.open_yn||(this.$message.warning("已超過開放認證時間，請確認!!"),!1)}},components:{"v-teaconsultform":c.Z,"v-pubquery":o.Z,"v-stufilelist":l.Z,"v-fileupload":d.Z},beforeDestroy(){},mounted(){},beforeMount(){let e="";switch(this.userStatic.data_structure){case"teaattestation":this.data_structure=u.Kk;break;default:}_=this.api_interface.get_OpOpenYN,e={year_id:111,sms_id:1,grade_id:"1",type_id:"02",token:this.$token},this.operate_state=p.an(this,_,e,this.$token)},computed:{render_header(){let e=this.data_structure.header.filter((e=>"N"===e.hidden)).sort((function(e,t){return e.sort>t.sort?1:-1}));return e}},watch:{tableData:function(e,t){}}},m=h,g=a(1001),f=(0,g.Z)(m,n,i,!1,null,null,null),w=f.exports,k={name:"TeaConsultView",props:{userStatic:{type:Object},api_interface:{type:Object}},data:function(){return{activeName:"first",pagetotal1:0,pagetotal2:0,currentPage:1,pageSize:10,parameter:{year_id:"",sms_id:""},tableData:[],tableVerify:[],tableRelease:[],stuData:[],complex_key:{},tea_consult:{},activePage:"0"}},components:{PubQuery:o.Z,TeaAttestationGrid:w},methods:{handleClick:function(e,t){this.activePage=e.index},getcondition:function(e){this.parameter.year_id=e.year,this.parameter.sms_id=e.sms,"0"==this.activePage?this.getdata1(this.parameter):this.getdata2(this.parameter)},getdata1:function(e){let t=this;const a=t.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.parameter.emp_id="",t.parameter.year_id=e.year_id,t.parameter.sms_id=e.sms_id,t.parameter.sRowNun=1,t.parameter.eRowNun=999,t.parameter.sch_no="",t.parameter.token=t.$token,t.$http({url:t.api_interface.get_Verify,method:"get",params:t.parameter,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?(t.tableVerify=e.data.dataset,t.tableVerify.forEach((function(e,t,a){"Y"==e.v?e.x_status="已發佈":e.x_status=!1})),t.total=e.data.dataset[0].x_cnt):(t.tableVerify=[],t.$message.error("查無資料，請確認"))})).catch((e=>{t.tableVerify=[],t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>a.close()))},getdata2:function(e){let t=this;const a=t.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.parameter.emp_id="",t.parameter.year_id=e.year_id,t.parameter.sms_id=e.sms_id,t.parameter.sRowNun=1,t.parameter.eRowNun=999,t.parameter.sch_no="",t.parameter.token=t.$token,t.$http({url:t.api_interface.get_Release,method:"get",params:t.parameter,headers:{SkyGet:t.$token}}).then((e=>{"Y"==e.data.status?(t.tableRelease=e.data.dataset,t.tableRelease.forEach((function(e,t,a){"Y"==e.v?e.x_status="已發佈":e.x_status=!1})),t.total=e.data.dataset[0].x_cnt):(t.tableRelease=[],t.$message.error("查無資料，請確認"))})).catch((e=>{t.tableVerify=[],t.$message({message:"系統發生錯誤"+e,type:"error",duration:0,showClose:!0})})).finally((()=>a.close()))}},mounted:function(){}},y=k,b=(0,g.Z)(y,r,s,!1,null,null,null),v=b.exports}}]);