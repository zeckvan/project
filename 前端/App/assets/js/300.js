"use strict";(self["webpackChunkportfolio"]=self["webpackChunkportfolio"]||[]).push([[300],{437:function(e,t,a){a.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"檔案上傳",visible:e.dialogFormVisible,fullscreen:!1,width:"50%","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close}},[t("div",{attrs:{align:"left"}},[t("el-form",{attrs:{"label-width":"120px"}},[t("el-row",[t("el-upload",{ref:"upload",attrs:{action:"","on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-change":e.handelChange,"before-upload":e.beforeupload,"http-request":e.uploadfile,"list-type":"picture",limit:e.limit,"auto-upload":!1,accept:e.file_accept}},[t("el-button",{attrs:{slot:"trigger",size:"small"},slot:"trigger"},[e._v("選擇檔案")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"info",disabled:e.check_disabled},on:{click:e.submitUpload}},[e._v("上傳檔案")]),t("el-divider",{attrs:{"content-position":"left"}},[t("div",[e._v("上傳檔案注意事項：")])]),t("div",{attrs:{slot:"tip"},slot:"tip"},[t("el-tag",{attrs:{type:"primary"}},[e._v("文件類")]),e._v(" "+e._s(e.docrule1)+" "),t("br"),t("br"),t("el-tag",{attrs:{type:"success"}},[e._v("影音類")]),e._v(" "+e._s(e.docrule2)+" ")],1)],1)],1),t("el-divider",{attrs:{"content-position":"left"}},[t("div",[e._v("上傳檔案內容簡述：")])]),t("el-row",[t("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)],1)],1),t("br"),t("br"),t("div",{attrs:{align:"right"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.cancel}},[e._v("關閉視窗")])],1)])],1)},l=[];const o={list:[{type:1,doc:"pdf",size:4,format:"application/pdf"},{type:1,doc:"jpg",size:4,format:"image/jpeg"},{type:1,doc:"jpeg",size:4,format:"image/jpeg"},{type:1,doc:"png",size:4,format:"image/png"},{type:2,doc:"mp3",size:10,format:"audio/mpeg"},{type:2,doc:"mp4",size:10,format:"video/mp4"}]};var s={props:{dialog_show:{type:Boolean},filelist:{type:Array},userStatic:{type:Object},parameter:{type:Object},data_structure:{type:Object},rowdata:{type:Object},api_interface:{type:Object}},data(){return{dialogFormVisible:this.dialog_show,show_file:!0,show_upload:!1,limit:2,apiurl:"",formdata:{},filelisttemp:[],filenametemp:"",docrule1:"",docrule2:"",check_disabled:!0,file_accept:"",content:"",result:{show:!1,filename:"",success:!0},success:!1}},methods:{close:function(){this.result.show=!1,this.result.success=this.success,this.$emit("get-show",this.result)},cancel:function(){this.check_disabled?this.dialogFormVisible=!1:this.$confirm("已挑選檔案尚未上傳是否關閉視窗?","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.dialogFormVisible=!1})).catch((()=>{}))},getshow:function(e){this.isShow=e.show},handelChange:function(e,t){""==this.filenametemp?this.filenametemp=e.name:this.filenametemp==e.name?t.splice(1,1):this.filenametemp!=e.name&&(t.splice(0,1),this.filenametemp=e.name),this.filelisttemp=t;var a=o.list.filter((function(t,a,i){return t.format==e.raw.type}));return a.length<=0?(this.$message.error("上傳格式不符合規範，請確認!!"),this.check_disabled=!0,this.filenametemp="",t.splice(0,1),!1):e.raw.size/1024/1024>a[0].size?(this.$message.error("上傳大小不符合規範，請確認!!"),this.check_disabled=!0,this.filenametemp="",t.splice(0,1),!1):void(this.check_disabled=!1)},handleRemove(e,t){this.filenametemp="",this.check_disabled=!0},handlePreview(e){},beforeupload(e){},uploadfile(e){},submitUpload(){let e=this,t="",a=new FormData,i="";e.data_structure.header.forEach((function(t,i,l){"Y"==t.parameter&&a.append(t.col,e.rowdata.row[t.prop])}));let l=e.filelisttemp[0].raw.name;e.result.filename=l.substr(1,l.lastIndexOf(".")-1),a.append("files",e.filelisttemp[0].raw),a.append("class_name",e.userStatic.interface),a.append("content",e.content),"StuAttestation"==e.userStatic.interface?(i=`${e.rowdata.row.a}_${e.rowdata.row.b}_${e.rowdata.row.c}_${e.rowdata.row.d}_${e.rowdata.row.e}_${e.rowdata.row.f}_${e.rowdata.row.g}_${e.rowdata.row.h}_0`,a.append("complex_key",i)):"StudCadre"==e.userStatic.interface?(i=`${e.rowdata.row.a}_${e.rowdata.row.c}_${e.rowdata.row.d}_${e.rowdata.row.b}_${e.rowdata.row.e}_${e.rowdata.row.h}`,a.append("complex_key",i)):(i=`${e.rowdata.row.a}_${e.rowdata.row.b}_${e.rowdata.row.c}_${e.rowdata.row.d}_${e.rowdata.row.e}`,a.append("complex_key",i)),a.append("token",e.$token),t=e.api_interface.file_upload;const o=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});e.$http({url:t,method:"post",data:a,headers:{SkyGet:e.$token}}).then((t=>{o.close(),"Y"==t.data.status?(e.$message.success("上傳成功!!"),e.success=!0,e.check_disabled=!0,e.cancel()):e.$message.error("上傳失敗")})).catch((t=>{e.$message.error("上傳失敗，請確認:"+t)})).finally((()=>o.close()))}},mounted(){let e=this,t=0,a=0,i="",l="";o.list.forEach((function(o,s,r){1==o.type?(t=o.size,i+=o.doc+"、"):(a=o.size,l+=o.doc+"、"),e.file_accept+="."+o.doc+", "})),this.docrule1="格式限制："+i.substr(0,i.length-1)+";大小限制:"+t+"MB",this.docrule2="格式限制："+l.substr(0,l.length-1)+";大小限制:"+a+"MB",e.file_accept=e.file_accept.substr(0,e.file_accept.length-1)},beforeMount(){}},r=s,n=a(1001),c=(0,n.Z)(r,i,l,!1,null,null,null),d=c.exports},4442:function(e,t,a){a.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"檔案列表","show-close":!1,visible:e.dialogFormVisible,fullscreen:!1,width:"100%","close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.filelist,stripe:"","row-style":e.rowState}},[t("el-table-column",{attrs:{type:"index",width:"50"}}),"stuattestationconfirm"==this.userStatic.data_structure?t("el-table-column",{attrs:{prop:"attestation_file_yn",width:"80","header-align":"center",align:"center",label:"確認上傳勾選"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.userStatic.checkbox?t("div",[a.row.attestation_file_yn?t("div",[t("el-tag",{staticStyle:{color:"white"},attrs:{type:"success"}},[e._v("已確認")])],1):t("div",[t("el-tag",{attrs:{type:"danger"}},[e._v("未確認")])],1)]):t("div",[t("el-checkbox",{attrs:{disabled:a.row.x_centraldb>0},on:{change:function(t){return e.check_yn(a)}},model:{value:a.row.attestation_file_yn,callback:function(t){e.$set(a.row,"attestation_file_yn",t)},expression:"scope.row.attestation_file_yn"}})],1)]}}],null,!1,4230699469)}):e._e(),t("el-table-column",{attrs:{prop:"file_class",label:"檔案類型"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:1==a.row.file_class?"primary":"success","disable-transitions":""}},[e._v(e._s(1==a.row.file_class?"文件類":"影音類")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"file_name",label:"檔案名稱"}}),t("el-table-column",{attrs:{prop:"upd_dt",label:"檔案上傳時間"}}),e.userStatic.file_download?t("el-table-column",{attrs:{label:"下載檔案",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-picture",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.file_download(a)}}})]}}],null,!1,1026815412)}):e._e(),e.userStatic.file_delete?t("el-table-column",{attrs:{label:"檔案刪除",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-delete-solid",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.file_delete(a)}}})]}}],null,!1,76193500)}):e._e()],1),t("br"),t("br"),t("el-row",[t("el-col",{attrs:{span:22}},["stuattestationconfirm"==this.userStatic.data_structure?t("div",{attrs:{align:"left"}},[this.filelist.length>0?t("div",[e._v(" 可確認上傳檔案數量："+e._s(this.filelist[0].x_file_center_cnt)+" ")]):e._e()]):e._e()]),t("el-col",{attrs:{span:2}},[t("div",{attrs:{align:"right"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.cancel}},[e._v("關閉視窗")])],1)])],1)],1)],1)},l=[],o={props:{dialog_show:{type:Boolean},filelist:{type:Array},userStatic:{type:Object},parameter:{type:Object},api_interface:{type:Object}},data(){return{dialogFormVisible:this.dialog_show,url:"",srcList:[],show_file:!0,show_upload:!1,limit:1,tableData:[],result:{file_cnt:0,show:!1}}},methods:{check_yn:function(e){var t=0;let a=this,i=new FormData;if(this.filelist.forEach(((e,a)=>{1==e.attestation_file_yn&&(t++)})),t>e.row.x_file_center_cnt)return a.$message.warning("已達上傳檔案上限，請確認!!"),a.filelist[e.$index].attestation_file_yn=!1,!1;i.append("complex_key",e.row.complex_key),i.append("number_id",e.row.number_id),e.row.attestation_file_yn?i.append("check_yn","Y"):i.append("check_yn","N"),i.append("token",a.$token);const l=a.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),o=a.api_interface.file_checkYN;a.$http({url:o,method:"put",data:i,headers:{SkyGet:a.$token}}).then((i=>{"Y"==i.data.status?e.row.x_file_center_cnt-t:a.$message.error(i.data.message)})).catch((e=>{a.$message({message:"異動失敗:"+e,type:"error",duration:0,showClose:!0})})).finally((()=>l.close()))},rowState(e,t){return{backgroundColor:"#f4f4f5"}},close:function(){var e=0;this.filelist.length>0?(this.filelist.forEach(((t,a)=>{1==t.attestation_file_yn&&e++})),this.result.file_cnt=e):this.result.file_cnt=0,this.result.show=!1,this.$emit("get-show",this.result)},cancel:function(){this.dialogFormVisible=!1},getshow:function(e){this.isShow=e.show},file_delete:function(e){let t=this,a="";const i=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.parameter.number_id=e.row.number_id,a=t.api_interface.file_download,t.$confirm("確定刪除?","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{t.$http({url:a,method:"delete",data:t.parameter,responseType:"blob",headers:{SkyGet:t.$token}}).then((a=>{"OK"==a.statusText||"200"==a.status?(t.$message.success("檔案刪除成功!!"),t.filelist.splice(e.$index,1)):t.$message.error("檔案刪除發生錯誤!!")})).catch((e=>{t.$message.error("檔案刪除發生錯誤:"+e)})).finally((()=>i.close()))})).catch((()=>{})).finally((()=>i.close()))},file_download:function(e){let t=this,a="";const i=t.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});t.parameter.number_id=e.row.number_id,a=t.api_interface.file_download,t.$http({url:a,method:"get",params:t.parameter,responseType:"blob",headers:{SkyGet:t.$token}}).then((a=>{t.download(a,e)})).catch((e=>{t.$message.error("檔案下載發生錯誤:"+e)})).finally((()=>i.close()))},download:function(e,t){let a=this,i=e.data,l=new Blob([i]),o=t.row.file_name+"."+t.row.file_extension;if("download"in document.createElement("a"))if("OK"==e.statusText||"200"==e.status){let e=document.createElement("a");e.download=o,e.style.displya="none",e.href=URL.createObjectURL(l),document.body.appendChild(e),e.click(),URL.revokeObjectURL(e.href),document.body.removeChild(e)}else a.$message.error("檔案下載發生錯誤!!");else navigator.msSaveBold(l,o)},handleRemove(e,t){},handlePreview(e){},submitUpload(){this.$refs.upload.submit()}},mounted(){},beforeMount(){},watch:{fileList:function(e,t){}}},s=o,r=a(1001),n=(0,r.Z)(s,i,l,!1,null,"36fc6f3d",null),c=n.exports}}]);