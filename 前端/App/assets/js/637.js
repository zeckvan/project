"use strict";(self["webpackChunkportfolio"]=self["webpackChunkportfolio"]||[]).push([[637],{9094:function(t,e,a){a.r(e),a.d(e,{default:function(){return x}});var r=function(){var t=this,e=t._self._c;return e("div",[e("v-pubquery",{on:{"get-condition":t.getcondition}}),t.data_structure.course_select?e("div",{staticStyle:{"margin-bottom":"10px"},attrs:{align:"left"}},[e("el-button",{attrs:{type:"warning"}},[t._v("新增認證課程")])],1):t._e(),t.data_structure.add_data?e("div",{staticStyle:{"margin-bottom":"10px"},attrs:{align:"left"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("新增")])],1):t._e(),t.data_structure.centraldb_batch?e("div",{attrs:{align:"left"}},["Y"==t.operate_state.open_yn?e("div",[e("el-button",{attrs:{type:"primary"},on:{click:t.centraldb_batch}},[t._v("確認存檔")])],1):e("div",[e("el-alert",{attrs:{closable:!1,title:"系統開放勾選時間："+t.operate_state.startdate+"~"+t.operate_state.enddate,type:"error"}})],1)]):t._e(),"stuattestation"==this.formSaveCheck?e("div",{attrs:{align:"left"}},["Y"==t.operate_state.open_yn?e("div"):e("div",[e("el-alert",{attrs:{closable:!1,title:"系統開放認証及上傳時間："+t.operate_state.startdate+"~"+t.operate_state.enddate,type:"error"}})],1)]):t._e(),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,height:"70vh",stripe:"","row-style":t.rowState},on:{"header-click":t.headerclick}},[e("el-table-column",{attrs:{type:"index",width:"50"}}),t.data_structure.checkbox?e("el-table-column",{staticStyle:{cursor:"pointer"},attrs:{prop:"x_status",width:"80","header-align":"center",align:"center",label:"全選"},scopedSlots:t._u([{key:"default",fn:function(a){return[""==a.row.x_status||1==a.row.x_status||0==a.row.x_status?e("div",[e("el-checkbox",{model:{value:a.row.x_status,callback:function(e){t.$set(a.row,"x_status",e)},expression:"scope.row.x_status"}})],1):e("div",[e("el-tag",{attrs:{type:"primary",effect:"dark"}},[t._v(t._s(a.row.x_status))])],1)]}}],null,!1,430463409)}):t._e(),t._l(t.render_header,(function(a){return e("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,width:a.width,align:"center"},scopedSlots:t._u([{key:"default",fn:function(r){return[a.slot?e("div",["attestation_send"==a.col?e("div",[""==r.row.l||null==r.row.l||"F"==r.row.n&&"Y"==r.row.x?e("div",[e("el-button",{attrs:{type:"primary",size:"small "},on:{click:function(e){return t.send(r)}}},[t._v("送出認證")])],1):e("div",[t._v(" "+t._s(r.row[a.prop])+" ")])]):"attestation_centraldb"==a.col?e("div",[e("div",{attrs:{align:"center"}},[e("el-checkbox",{model:{value:r.row.v,callback:function(e){t.$set(r.row,"v",e)},expression:"scope.row.v"}})],1)]):e("div",["N"!=r.row.n&&"Y"!=r.row.n&&"F"!=r.row.n||""!=r.row.x&&null!=r.row.x?"Y"==r.row.n&&"Y"==r.row.x?e("div",[e("el-tag",{attrs:{type:"primary",effect:"dark"}},[t._v("認證成功")])],1):"F"==r.row.n&&"Y"==r.row.x?e("div",[e("el-popover",{attrs:{placement:"top-start",title:"認證失敗原因：",width:"200",trigger:"hover",content:r.row.w}},[e("el-tag",{attrs:{slot:"reference",type:"danger",effect:"dark"},slot:"reference"},[t._v("認證失敗")])],1)],1):t._e():e("div",[e("el-tag",{attrs:{type:"success",effect:"dark"}},[t._v("認證中")])],1)])]):e("div",[t._v(" "+t._s(r.row[a.prop])+" ")])]}}],null,!0)},[t._v(" > ")])})),t.data_structure.query_data?e("el-table-column",{attrs:{align:"center",fixed:"right",label:"檢視資料",width:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-search",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.edit_data(a)}}})]}}],null,!1,352033032)}):t._e(),t.data_structure.upload_file?e("el-table-column",{attrs:{align:"center",fixed:"right",label:"上傳檔案",width:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-upload",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.file_upload(a)}}})]}}],null,!1,1194572588)}):t._e(),"stuattestation"==this.formSaveCheck?e("el-table-column",{attrs:{align:"center",fixed:"right",label:"可上傳檔案數",width:""},scopedSlots:t._u([{key:"default",fn:function(t){return[e("el-badge",{staticClass:"item",attrs:{value:t.row.x_file_cnt-t.row.x_cnt,type:"primary"}})]}}],null,!1,2782464928)}):t._e(),"stuattestationconfirm"==this.userStatic.data_structure?e("el-table-column",{attrs:{align:"center",fixed:"right",label:"已勾選確認檔案數",width:""},scopedSlots:t._u([{key:"default",fn:function(t){return[e("el-badge",{staticClass:"item",attrs:{value:t.row.x_file_center_cnt,type:"primary"}})]}}],null,!1,2063623175)}):t._e(),t.data_structure.download_file?e("el-table-column",{attrs:{align:"center",fixed:"right",label:"查看檔案",width:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-badge",{staticClass:"item",staticStyle:{cursor:"pointer"},attrs:{value:a.row.x_cnt,type:"info"},nativeOn:{click:function(e){return t.file_data(a)}}})]}}],null,!1,3552961885)}):t._e(),t.data_structure.delete_data?e("el-table-column",{attrs:{align:"center",fixed:"right",label:"刪除資料",width:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.del_data(a)}}})]}}],null,!1,1279394094)}):t._e()],2),e("el-pagination",{attrs:{"page-size":t.pageSize,total:t.total,layout:"total,prev, pager, next,sizes"},on:{"current-change":t.current_change,"size-change":t.size_change}}),t.isShow?e(t.content,{tag:"component",attrs:{dialog_show:t.dialog_show,edit_model:t.edit_model,parameter:t.parameter,data_structure:t.data_structure,userStatic:t.userStatic,api_interface:t.api_interface,formSaveCheck:t.formSaveCheck},on:{"update:dialog_show":function(e){t.dialog_show=e},"get-show":t.getshow}}):t._e(),t.isShow2?e("v-stufilelist",{attrs:{dialog_show:t.dialog_show2,filelist:t.filelist,userStatic:t.userStatic,parameter:t.parameter,api_interface:t.api_interface},on:{"update:dialog_show":function(e){t.dialog_show2=e},"get-show":t.getshow2}}):t._e(),t.isShow3?e("v-fileupload",{attrs:{dialog_show:t.dialog_show3,filelist:t.filelist,userStatic:t.userStatic,api_interface:t.api_interface,parameter:t.parameter,data_structure:t.data_structure,rowdata:t.rowdata},on:{"update:dialog_show":function(e){t.dialog_show3=e},"get-show":t.getshow3}}):t._e()],1)},s=[],o=a(4442),i=a(7020),n=a(6157),c=a(8227),l=a(4779),u=a(5974),d=a(5714),h=a(7296),_=a(5922),f=a(7277),p=a(9405),m=a(2167),g=a(5705),w=a(437),k=a(8304),b="",v={props:{userStatic:{type:Object},api_interface:{type:Object}},data(){return{formSaveCheck:"",content:this.userStatic.form_component,data_structure:{},tableData:[],isShow:!1,isShow2:!1,isShow3:!1,dialog_show:!0,dialog_show2:!0,dialog_show3:!0,total:0,currentPage:1,pageSize:10,year:"",sms:"",edit_model:"",parameter:{},filelist:[],rowdata:{},check_list:[],datarow:{},operate_state:{open_yn:"",startdate:"",enddate:""}}},methods:{centraldb_batch:function(){var t=0;let e=this,a=new FormData;e.check_list.length=0,this.tableData.forEach(((a,r)=>{e.check_list[t++]=a})),e.check_list.forEach((function(t,e,r){a.append("centraldb[]",t.v),a.append("complex_key[]",t.a+"_"+t.b+"_"+t.c+"_"+t.d+"_"+t.e+"_"+t.f+"_"+t.g+"_"+t.h+"_"+t.i+"@"+t.v)})),a.append("token",e.$token);const r=e.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=e.api_interface.save_form;e.$http({url:s,method:"put",data:a,headers:{SkyGet:e.$token}}).then((t=>{if("Y"==t.data.status){e.$message.success("存檔成功!!");var a={year:e.year,sms:e.sms};e.getcondition(a)}else e.$message.error(t.data.message)})).catch((t=>{e.$message({message:"存檔失敗:"+t,type:"error",duration:0,showClose:!0})})).finally((()=>r.close()))},confirm_batch:function(){var t=0;let e=this,a=new FormData;if(e.check_list.length=0,this.tableData.forEach(((a,r)=>{1==a.x_status&&(e.check_list[t++]=a)})),0==e.check_list.length)return e.$message.error("未勾選學習成果認証，請確認!!"),!1;e.check_list.forEach((function(t,e,r){a.append("complex_key[]",t.a+"_"+t.b+"_"+t.c+"_"+t.d+"_"+t.e+"_"+t.f+"_"+t.g+"_"+t.h)})),a.append("token",e.$token),e.$confirm("確定送出學習成果認証?","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=e.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=e.api_interface.save_form;e.$http({url:r,method:"put",data:a,headers:{SkyGet:e.$token}}).then((t=>{if("Y"==t.data.status){e.$message.success("送出成功!!");var a={year:e.year,sms:e.sms};e.getcondition(a)}else e.$message.error(t.data.message)})).catch((t=>{e.$message({message:"送出失敗:"+t,type:"error",duration:0,showClose:!0})})).finally((()=>t.close()))})).catch((()=>{}))},cellmouseenter(t,e,a,r){},headerclick(t,e){"全選"!=t.label&&"全不選"!=t.label||("全選"==t.label?(t.label="全不選",this.tableData.forEach(((t,e)=>{0!=t.x_status&&""!=t.x_status||(t.x_status=!0)}))):(t.label="全選",this.tableData.forEach(((t,e)=>{1!=t.x_status&&""!=t.x_status||(t.x_status=!1)}))))},send:function(t){let e=this,a=new FormData;return"N"==this.operate_state.open_yn?(e.$message.warning("已超過開放認證時間，請確認!!"),!1):0==t.row.x_cnt?(e.$message.warning("請先上傳檔案後，再執行送出認証。"),!1):(this.data_structure.header.forEach((function(e,r,s){a.append(e.col,t.row[e.prop])})),a.append("token",e.$token),void e.$confirm("確定送出?一但送出後該項目無法修正!!","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=e.$loading({lock:!0,text:"資料處理中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=e.api_interface.save_form;e.$http({url:r,method:"put",data:a,headers:{SkyGet:e.$token}}).then((t=>{if("Y"==t.data.status){e.$message.success("送出成功!!");var a={year:e.year,sms:e.sms};e.getcondition(a)}else e.$message.error(t.data.message)})).catch((t=>{e.$message({message:"送出失敗:"+t,type:"error",duration:0,showClose:!0})})).finally((()=>t.close()))})).catch((()=>{})))},rowState(t,e){return{backgroundColor:"#f4f4f5"}},add:function(){this.edit_model="add",this.isShow=!0},edit_data:function(t){let e=this;this.data_structure.header.forEach((function(a,r,s){"Y"==a.parameter&&(e.parameter[a.col]=t.row[a.prop])})),this.edit_model="edit",this.isShow=!0},file_data:function(t){this.datarow=t;let e=this,a="";b=e.api_interface.file_data;const r=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});e.data_structure.header.forEach((function(a,r,s){"Y"==a.parameter&&(e.parameter[a.col]=t.row[a.prop])})),e.parameter["class_name"]=e.userStatic.interface,"StuAttestation"==e.userStatic.interface&&("N"==t.row.n||"Y"==t.row.n||"stuattestationconfirm"==e.formSaveCheck?(e.userStatic.file_delete=!1,e.parameter["deleteFile"]="N"):(e.userStatic.file_delete=!0,e.parameter["deleteFile"]="Y")),e.userStatic.checkbox=!1,"stuattestationconfirm"==e.userStatic.data_structure?e.parameter["flag"]="Y":e.parameter["flag"]="N",a="StuAttestation"==e.userStatic.interface?`${t.row.a}_${t.row.b}_${t.row.c}_${t.row.d}_${t.row.e}_${t.row.f}_${t.row.g}_${t.row.h}_0`:"StudCadre"==e.userStatic.interface?`${t.row.a}_${t.row.c}_${t.row.d}_${t.row.b}_${t.row.e}_${t.row.h}`:`${t.row.a}_${t.row.b}_${t.row.c}_${t.row.d}_${t.row.e}`,e.parameter["complex_key"]=a,e.parameter["token"]=e.$token,e.$http({url:b,method:"get",params:e.parameter,headers:{SkyGet:e.$token}}).then((t=>{"Y"==t.data.status?("stuattestationcentraldb"==e.formSaveCheck?e.filelist=t.data.dataset.filter((function(t,e,a){return"Y"==t.attestation_file_yn})):e.filelist=t.data.dataset,e.filelist.forEach((function(t,e,a){"Y"==t.attestation_file_yn?t.attestation_file_yn=!0:t.attestation_file_yn=!1}))):(e.filelist=[],e.$message.error("查無資料，請確認"))})).catch((t=>{e.tableData=[],e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>r.close())),this.isShow2=!0},file_upload:function(t){this.datarow=t;let e=this;if("stuattestation"==e.formSaveCheck){if(t.row.x_file_cnt-t.row.x_cnt<=0)return e.$message.warning("已達上傳檔案上限，請確認!!"),!1;if("N"==this.operate_state.open_yn)return e.$message.warning("已超過開放上傳檔案時間，請確認!!"),!1}if("StuAttestation"==e.userStatic.interface&&("N"==t.row.n||"Y"==t.row.n))return e.$message.warning("該項目狀態為「認証中」或「認証成功」，無法執行檔案上傳功能。"),!1;b=e.api_interface.file_upload,e.rowdata=t,e.data_structure.header.forEach((function(a,r,s){"Y"==a.parameter&&(e.parameter[a.col]=t.row[a.prop])})),e.parameter["token"]=e.$token,this.isShow3=!0},del_data:function(t){let e=this;if("Y"===this.data_structure.delete_rule.rule_flag&&!this.data_structure.delete_rule.rule_check(t,e))return!1;e.$confirm("確定刪除?","Warning",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a=e.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let r=new FormData;e.data_structure.header.forEach((function(a,s,o){"Y"==a.parameter&&(e.parameter[a.col]=t.row[a.prop],r.append(a.col,t.row[a.prop]))})),r.append("token",e.$token),r.append("class_name",e.userStatic.interface),b=e.api_interface.del_data,e.$http({headers:{"Content-Type":"application/json;charset=utf-8",SkyGet:e.$token},url:b,method:"delete",data:r}).then((a=>{"Y"==a.data.status?(e.$message.success("刪除成功!!"),e.tableData.splice(t.$index,1)):e.$message.error("刪除失敗!!")})).catch((t=>{e.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>a.close()))})).catch((()=>{}))},getshow:function(t){this.isShow=t.show},getshow2:function(t){"stuattestationcentraldb"==this.formSaveCheck&&(this.tableData[this.datarow.$index].x_file_center_cnt=Number(t.file_cnt)),this.isShow2=t.show},getshow3:function(t){let e=this.tableData[this.datarow.$index].x_cnt,a=this.tableData[this.datarow.$index].s;t.success&&(e=""==e||null==e?1:e+=1,a=""==a||null==a?t.filename:a=a+","+t.filename,this.tableData[this.datarow.$index].x_cnt=Number(e),this.tableData[this.datarow.$index].s=a),this.isShow3=t.show},getcondition:function(t){var e=this;e.year=t.year,e.sms=t.sms,b=e.api_interface.get_data,this.get_data(b,t.year,t.sms,e.currentPage,e.pageSize)},current_change(t){var e=this,a="",r="";a=(t-1)*e.pageSize+1,r=t*e.pageSize,e.currentPage=t,b=e.api_interface.get_data,this.get_data(b,e.year,e.sms,a,r)},size_change(t){var e=this,a="",r="";a=(e.currentPage-1)*t+1,r=e.currentPage*t,e.pageSize=t,b=e.api_interface.get_data,this.get_data(b,e.year,e.sms,a,r)},get_data:function(t,e,a,r,s){let o=this;const i=o.$loading({lock:!0,text:"資料讀取中，請稍後。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});o.parameter.emp_id="",o.parameter.std_no="",o.parameter.year_id=e,o.parameter.sms_id=a,o.parameter.sRowNun=r,o.parameter.eRowNun=s,o.parameter.sch_no="",o.parameter.is_sys="0",o.parameter.token=o.$token,o.$http({url:t,method:"get",params:o.parameter,headers:{SkyGet:o.$token}}).then((t=>{"Y"==t.data.status?("stuattestationcentraldb"==o.formSaveCheck?o.tableData=t.data.dataset.filter((function(t,e,a){return t.x_cnt>0})):o.tableData=t.data.dataset,o.tableData.forEach((function(t,e,a){o.data_structure.confirm_batch&&("Y"==t.u?t.x_status="已送出":t.x_status=!1),o.data_structure.centraldb_batch&&("Y"==t.v?t.v=!0:t.v=!1)})),o.total=t.data.dataset[0].x_total,o.tableData.length<=0&&o.$message.error("查無資料，請確認")):(o.tableData=[],o.$message.error("查無資料，請確認"))})).catch((t=>{o.tableData=[],o.$message({message:"系統發生錯誤"+t,type:"error",duration:0,showClose:!0})})).finally((()=>i.close()))}},components:{"v-stucadreform":i.Z,"v-stustudyform":n.Z,"v-pubquery":g.Z,"v-stufilelist":o.Z,"v-fileupload":w.Z,"v-stugroupform":c.Z,"v-stucollegeform":l.Z,"v-stuworkplaceform":u.Z,"v-stuotherform":d.Z,"v-sturesultform":h.Z,"v-stuvolunteerform":_.Z,"v-stulicenseform":f.Z,"v-stucompetitionform":p.Z,"v-stuconsultQueryform":m.Z},beforeDestroy(){},mounted(){console.log(this.$token)},beforeMount(){console.log(this.userStatic.data_structure);let t="";switch(this.userStatic.data_structure){case"stucadre":this.data_structure=k.CX,this.formSaveCheck="stucadre";break;case"stustudyf":this.data_structure=k.xQ,this.formSaveCheck="stustudyf";break;case"stugroup":this.data_structure=k.L1,this.formSaveCheck="stugroup";break;case"stucollege":this.data_structure=k.Xk,this.formSaveCheck="stucollege";break;case"stuworkplace":this.data_structure=k.Hj,this.formSaveCheck="stuworkplace";break;case"stuother":this.data_structure=k.uD,this.formSaveCheck="stuother";break;case"sturesult":this.data_structure=k.RM,this.formSaveCheck="sturesult";break;case"stuvolunteer":this.data_structure=k.vo,this.formSaveCheck="stuvolunteer";break;case"stulicense":this.data_structure=k.vL,this.formSaveCheck="stulicense";break;case"stucompetition":this.data_structure=k.zz,this.formSaveCheck="stucompetition";break;case"stuconsult_query":this.data_structure=k.cL,this.formSaveCheck="stuconsult_query";break;case"stuattestation":this.data_structure=k.Hc,this.formSaveCheck="stuattestation",b=this.api_interface.get_OpOpenYN,t={year_id:111,sms_id:1,grade_id:"1",type_id:"01",token:this.$token},this.operate_state=k.an(this,b,t,this.$token);break;case"stuattestationconfirm":this.data_structure=k.Cd,this.formSaveCheck="stuattestationconfirm";break;case"stuattestationcentraldb":this.data_structure=k.Eh,this.formSaveCheck="stuattestationcentraldb",b=this.api_interface.get_OpOpenYN,t={year_id:111,sms_id:0,grade_id:"1",type_id:"03",token:this.$token},this.operate_state=k.an(this,b,t,this.$token);break;default:}},computed:{render_header(){let t=this.data_structure.header.filter((t=>"N"===t.hidden)).sort((function(t,e){return t.sort>e.sort?1:-1}));return t}},filters:{timeString(t,e){return moment(t).format(e||"YYYY-MM-DD, HH:mm:ss")}}},y=v,S=a(1001),$=(0,S.Z)(y,r,s,!1,null,null,null),x=$.exports}}]);